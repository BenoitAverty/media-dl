- hosts: docker
  remote_user: root
  become: yes
  become_user: docker
  vars_files:
    - secrets.yml
  tasks:
    - name: Necessary folders
      file:
        path: "{{item}}"
        state: directory
      with_items:
        - ~/stacks
        - /var/swarm-data/config/media-dl
    - name: Copy config files
      copy:
        src: ./config/sonarr.xml
        dest: /var/swarm-data/config/media-dl/sonarr.xml
    - name: Copy stack file
      copy:
        src: ./media-dl.yml
        dest: ~/stacks/media-dl.yml
    - name: Stack deployment
      command: docker stack deploy -c ~/stacks/media-dl.yml media-dl
